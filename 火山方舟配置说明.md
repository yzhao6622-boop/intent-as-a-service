# 火山方舟（Ark）配置说明

## 什么是火山方舟？

火山方舟（Ark）是字节跳动推出的AI模型服务平台，提供多种高性能AI模型，包括DeepSeek V3、R1等。

## 配置步骤

### 1. 注册火山方舟账号

1. 访问 [火山引擎官网](https://www.volcengine.com/)
2. 注册账号并完成实名认证

### 2. 开通模型服务

1. 登录火山方舟控制台
2. 进入"模型商城"
3. 选择您需要的模型（推荐：DeepSeek V3 或 R1）
4. 创建访问点，设置月度预算
5. 获取模型ID（格式：`ep-20241208200930-xxxxx`）

### 3. 获取API密钥

1. 在控制台进入"API Key管理"
2. 创建长效密钥
3. 建议开启IP白名单功能以增强安全性
4. 复制API密钥

### 4. 配置环境变量

在项目的 `.env` 文件中配置：

```env
# 方式1: 使用API Key (推荐)
ARK_API_KEY=your-api-key-here

# 方式2: 使用AK/SK (如果API Key不可用)
# ARK_ACCESS_KEY=your-access-key
# ARK_SECRET_KEY=your-secret-key

ARK_MODEL_ID=ep-20241208200930-xxxxx
ARK_API_BASE_URL=https://ark.cn-beijing.volces.com/api/v3
```

**重要**：
- `ARK_API_KEY`: 您在API Key管理中创建的长效密钥（完整复制，不要有空格）
- `ARK_MODEL_ID`: 您在模型商城创建访问点时获得的模型ID（格式：`ep-xxxxx`，完整复制）
- `ARK_API_BASE_URL`: API基础URL（默认：`https://ark.cn-beijing.volces.com/api/v3`，可根据实际区域调整）

**常见问题**：
1. **API密钥格式**：确保密钥完整复制，前后没有空格或换行
2. **模型ID格式**：确保是完整的访问点ID，例如 `ep-20241208200930-xxxxx`
3. **API端点**：不同区域可能有不同的端点，请查看火山方舟控制台中的实际端点

### 5. 安装依赖

项目已配置 `volcenginesdkarkruntime` SDK，运行：

```bash
npm install
```

## 支持的模型

火山方舟支持多种模型，您可以根据需求选择：

- **DeepSeek V3**: 高性能通用模型，适合复杂推理任务
- **R1**: 推理能力强的模型
- 其他模型：可在模型商城中查看

## 费用说明

- DeepSeek系列模型享受50万免费Tokens额度
- 通过"用量分析"面板查看实时token消耗
- 可设置自动告警阈值，防止超额使用

## 高级功能

### 思维链功能

如需使用思维链功能，可以在API请求中添加：

```typescript
// 在aiService.ts中可以添加请求头
headers: {
  'X-Reasoning-Chain': 'true'
}
```

### 多模态处理

火山方舟支持多模态处理，可以上传文件进行OCR识别等。

## 故障排查

### API调用失败

**错误：API key or AK/SK is missing or invalid**

1. **检查API密钥配置**：
   - 确认 `.env` 文件中的 `ARK_API_KEY` 已正确设置
   - 确保密钥完整复制，前后没有空格或换行
   - 检查密钥是否在火山方舟控制台的"API Key管理"中有效且未过期

2. **检查模型ID**：
   - 确认 `ARK_MODEL_ID` 格式正确（通常以 `ep-` 开头）
   - 确保模型ID是在模型商城创建访问点后获得的完整ID
   - 验证访问点状态为"已启用"

3. **检查API端点**：
   - 确认 `ARK_API_BASE_URL` 是否正确
   - 不同区域可能有不同的端点，请查看控制台中的实际端点
   - 常见端点格式：`https://ark.{region}.volces.com/api/v3`

4. **其他检查**：
   - 检查账户余额是否充足
   - 检查网络连接是否正常
   - 检查IP白名单设置（如果已启用，确保当前IP在白名单中）

5. **获取帮助**：
   - 查看火山方舟官方文档
   - 在控制台的"用量分析"中查看API调用记录和错误详情
   - 联系火山方舟技术支持

### 模型响应慢

1. 检查选择的模型是否适合当前任务
2. 考虑使用更快的模型
3. 检查网络延迟

## 更多信息

- [火山方舟官方文档](https://www.volcengine.com/docs/8239)
- [模型商城](https://console.volcengine.com/ark/model-market)
