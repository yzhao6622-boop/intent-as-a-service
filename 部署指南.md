# äº‘ç«¯éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å°† Intent-as-a-Service åº”ç”¨éƒ¨ç½²åˆ°äº‘ç«¯ã€‚

## éƒ¨ç½²æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆ1ï¼šå…¨æ ˆéƒ¨ç½²ï¼ˆæ¨èæ–°æ‰‹ï¼‰
- **Vercel** - å‰åç«¯ä¸€ä½“åŒ–éƒ¨ç½²ï¼ˆæœ€ç®€å•ï¼‰
- **Railway** - å…¨æ ˆå¹³å°ï¼Œæ”¯æŒæ•°æ®åº“
- **Render** - ç±»ä¼¼ Herokuï¼Œç®€å•æ˜“ç”¨

### æ–¹æ¡ˆ2ï¼šåˆ†ç¦»éƒ¨ç½²ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰
- **å‰ç«¯**ï¼šVercel / Netlify
- **åç«¯**ï¼šRailway / Render / DigitalOcean
- **æ•°æ®åº“**ï¼šSupabase / PlanetScale / Railway PostgreSQL

### æ–¹æ¡ˆ3ï¼šVPSéƒ¨ç½²ï¼ˆæœ€çµæ´»ï¼‰
- **æœåŠ¡å™¨**ï¼šDigitalOcean / AWS EC2 / é˜¿é‡Œäº‘ / è…¾è®¯äº‘
- **æ•°æ®åº“**ï¼šè‡ªå»º PostgreSQL æˆ–ä½¿ç”¨äº‘æ•°æ®åº“

---

## æ–¹æ¡ˆä¸€ï¼šRailway éƒ¨ç½²ï¼ˆæœ€ç®€å•ï¼Œæ¨èï¼‰

Railway æ”¯æŒä¸€é”®éƒ¨ç½²ï¼Œè‡ªåŠ¨é…ç½®æ•°æ®åº“ã€‚

### æ­¥éª¤1ï¼šå‡†å¤‡ä»£ç 

1. ç¡®ä¿ä»£ç å·²æäº¤åˆ° GitHub
2. åˆ›å»º `railway.json` é…ç½®æ–‡ä»¶

### æ­¥éª¤2ï¼šåœ¨ Railway éƒ¨ç½²

1. è®¿é—® [Railway](https://railway.app/)
2. ä½¿ç”¨ GitHub ç™»å½•
3. ç‚¹å‡» "New Project" â†’ "Deploy from GitHub repo"
4. é€‰æ‹©æ‚¨çš„ä»“åº“
5. Railway ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶éƒ¨ç½²

### æ­¥éª¤3ï¼šé…ç½®ç¯å¢ƒå˜é‡

åœ¨ Railway é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ï¼š

```env
NODE_ENV=production
PORT=3002
JWT_SECRET=your-production-secret-key
ARK_API_KEY=your-ark-api-key
ARK_MODEL_ID=your-model-id
ARK_API_BASE_URL=https://ark.cn-beijing.volces.com/api/v3
DB_PATH=./data/intent.db
```

### æ­¥éª¤4ï¼šé…ç½®æ•°æ®åº“

Railway ä¼šè‡ªåŠ¨æä¾› PostgreSQLï¼Œä½†æˆ‘ä»¬éœ€è¦ SQLiteã€‚å¯ä»¥ï¼š
- ä½¿ç”¨ Railway çš„ Volume æŒä¹…åŒ– SQLite æ–‡ä»¶
- æˆ–è¿ç§»åˆ° PostgreSQLï¼ˆéœ€è¦ä¿®æ”¹ä»£ç ï¼‰

### æ­¥éª¤5ï¼šéƒ¨ç½²å‰ç«¯

1. åœ¨ Railway ä¸­æ·»åŠ ç¬¬äºŒä¸ªæœåŠ¡
2. é€‰æ‹© `client` ç›®å½•
3. æ„å»ºå‘½ä»¤ï¼š`npm run build`
4. å¯åŠ¨å‘½ä»¤ï¼š`npm run preview` æˆ–ä½¿ç”¨é™æ€æ–‡ä»¶æœåŠ¡

---

## æ–¹æ¡ˆäºŒï¼šVercel + Railwayï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

### å‰ç«¯éƒ¨ç½²åˆ° Vercel

1. **å®‰è£… Vercel CLI**
```bash
npm i -g vercel
```

2. **éƒ¨ç½²å‰ç«¯**
```bash
cd client
vercel
```

3. **é…ç½®ç¯å¢ƒå˜é‡**
åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ï¼š
```env
VITE_API_URL=https://your-backend-url.railway.app/api
```

4. **æ›´æ–° API é…ç½®**
ä¿®æ”¹ `client/src/api/client.ts`ï¼š
```typescript
const API_BASE_URL = import.meta.env.VITE_API_URL || 'https://your-backend-url.railway.app/api';
```

### åç«¯éƒ¨ç½²åˆ° Railway

1. æŒ‰ç…§æ–¹æ¡ˆä¸€çš„æ­¥éª¤éƒ¨ç½²åç«¯
2. è·å–åç«¯ URLï¼ˆä¾‹å¦‚ï¼š`https://your-app.railway.app`ï¼‰
3. æ›´æ–°å‰ç«¯ç¯å¢ƒå˜é‡æŒ‡å‘åç«¯ URL

---

## æ–¹æ¡ˆä¸‰ï¼šVPS éƒ¨ç½²ï¼ˆæœ€çµæ´»ï¼‰

### æœåŠ¡å™¨è¦æ±‚

- Ubuntu 20.04+ æˆ– CentOS 7+
- Node.js 18+
- Nginxï¼ˆç”¨äºåå‘ä»£ç†ï¼‰
- PM2ï¼ˆè¿›ç¨‹ç®¡ç†ï¼‰

### éƒ¨ç½²æ­¥éª¤

#### 1. è¿æ¥æœåŠ¡å™¨

```bash
ssh user@your-server-ip
```

#### 2. å®‰è£… Node.js

```bash
# Ubuntu
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# éªŒè¯
node --version
npm --version
```

#### 3. å®‰è£… PM2

```bash
sudo npm install -g pm2
```

#### 4. å…‹éš†ä»£ç 

```bash
git clone https://github.com/your-username/intent-as-a-service.git
cd intent-as-a-service
```

#### 5. å®‰è£…ä¾èµ–

```bash
npm install
cd client && npm install && cd ..
```

#### 6. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp env.example .env
nano .env
```

å¡«å…¥ç”Ÿäº§ç¯å¢ƒé…ç½®ã€‚

#### 7. æ„å»ºåº”ç”¨

```bash
# æ„å»ºåç«¯
npm run build:server

# æ„å»ºå‰ç«¯
npm run build:client
```

#### 8. åˆå§‹åŒ–æ•°æ®åº“

```bash
npm run migrate
```

#### 9. ä½¿ç”¨ PM2 å¯åŠ¨

åˆ›å»º `ecosystem.config.js`ï¼š

```javascript
module.exports = {
  apps: [{
    name: 'intent-api',
    script: './dist/server.js',
    instances: 1,
    exec_mode: 'fork',
    env: {
      NODE_ENV: 'production',
      PORT: 3002
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z'
  }]
};
```

å¯åŠ¨ï¼š
```bash
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

#### 10. é…ç½® Nginx

åˆ›å»º `/etc/nginx/sites-available/intent-service`ï¼š

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /path/to/intent-as-a-service/client/dist;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯ API
    location /api {
        proxy_pass http://localhost:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

å¯ç”¨é…ç½®ï¼š
```bash
sudo ln -s /etc/nginx/sites-available/intent-service /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

#### 11. é…ç½® SSLï¼ˆLet's Encryptï¼‰

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

---

## æ•°æ®åº“è¿ç§»ï¼ˆSQLite â†’ PostgreSQLï¼‰

å¦‚æœä½¿ç”¨äº‘æ•°æ®åº“ï¼Œéœ€è¦è¿ç§»åˆ° PostgreSQLã€‚

### 1. å®‰è£… PostgreSQL å®¢æˆ·ç«¯

```bash
npm install pg @types/pg
```

### 2. åˆ›å»ºæ–°çš„æ•°æ®åº“é…ç½®

åˆ›å»º `src/db/postgres.ts`ï¼š

```typescript
import { Pool } from 'pg';

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false
});

export { pool };
```

### 3. ä¿®æ”¹ schema.ts

å°† SQLite æŸ¥è¯¢æ”¹ä¸º PostgreSQL æŸ¥è¯¢ã€‚

---

## ç¯å¢ƒå˜é‡é…ç½®æ¸…å•

### å¿…éœ€çš„ç¯å¢ƒå˜é‡

```env
# æœåŠ¡å™¨
NODE_ENV=production
PORT=3002

# è®¤è¯
JWT_SECRET=your-very-secure-random-string

# ç«å±±æ–¹èˆŸ API
ARK_API_KEY=your-ark-api-key
ARK_MODEL_ID=your-model-id
ARK_API_BASE_URL=https://ark.cn-beijing.volces.com/api/v3

# æ•°æ®åº“
DATABASE_URL=postgresql://user:password@host:5432/dbname
# æˆ–ä½¿ç”¨ SQLite
DB_PATH=./data/intent.db
```

### å®‰å…¨å»ºè®®

1. **JWT_SECRET**ï¼šä½¿ç”¨å¼ºéšæœºå­—ç¬¦ä¸²ç”Ÿæˆå™¨
2. **API å¯†é’¥**ï¼šä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç 
3. **æ•°æ®åº“å¯†ç **ï¼šä½¿ç”¨å¼ºå¯†ç 
4. **HTTPS**ï¼šç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨ HTTPS

---

## éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] ä»£ç å·²æäº¤åˆ° Git ä»“åº“
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] æ•°æ®åº“å·²åˆå§‹åŒ–
- [ ] å‰ç«¯æ„å»ºæˆåŠŸ
- [ ] åç«¯æ„å»ºæˆåŠŸ
- [ ] API ç«¯ç‚¹å¯è®¿é—®
- [ ] å‰ç«¯å¯è®¿é—®
- [ ] SSL è¯ä¹¦å·²é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
- [ ] åŸŸåå·²é…ç½®
- [ ] ç›‘æ§å’Œæ—¥å¿—å·²è®¾ç½®

---

## å¸¸è§é—®é¢˜

### Q: æ•°æ®åº“æ–‡ä»¶ä¸¢å¤±æ€ä¹ˆåŠï¼Ÿ

A: ä½¿ç”¨äº‘æ•°æ®åº“ï¼ˆPostgreSQLï¼‰æˆ–é…ç½®æŒä¹…åŒ–å­˜å‚¨å·ã€‚

### Q: å¦‚ä½•æ›´æ–°åº”ç”¨ï¼Ÿ

A: 
```bash
git pull
npm install
npm run build
pm2 restart intent-api
```

### Q: å¦‚ä½•æŸ¥çœ‹æ—¥å¿—ï¼Ÿ

A: 
```bash
# PM2
pm2 logs intent-api

# Railway
åœ¨ Dashboard æŸ¥çœ‹æ—¥å¿—

# Vercel
åœ¨ Dashboard æŸ¥çœ‹æ—¥å¿—
```

### Q: å¦‚ä½•å¤‡ä»½æ•°æ®ï¼Ÿ

A: å®šæœŸå¯¼å‡ºæ•°æ®åº“æˆ–ä½¿ç”¨äº‘æ•°æ®åº“çš„è‡ªåŠ¨å¤‡ä»½åŠŸèƒ½ã€‚

---

## æ¨èå¹³å°å¯¹æ¯”

| å¹³å° | éš¾åº¦ | ä»·æ ¼ | é€‚åˆåœºæ™¯ |
|------|------|------|----------|
| Railway | â­ ç®€å• | å…è´¹é¢åº¦åä»˜è´¹ | å¿«é€Ÿéƒ¨ç½²ï¼Œå…¨æ ˆåº”ç”¨ |
| Vercel | â­ ç®€å• | å…è´¹é¢åº¦åä»˜è´¹ | å‰ç«¯éƒ¨ç½²ï¼ŒJAMstack |
| Render | â­â­ ä¸­ç­‰ | å…è´¹é¢åº¦åä»˜è´¹ | ç±»ä¼¼ Heroku |
| DigitalOcean | â­â­â­ è¾ƒéš¾ | æŒ‰éœ€ä»˜è´¹ | å®Œå…¨æ§åˆ¶ï¼ŒVPS |
| AWS | â­â­â­â­ å›°éš¾ | æŒ‰éœ€ä»˜è´¹ | ä¼ä¸šçº§ï¼Œå¤æ‚éœ€æ±‚ |

---

## å¿«é€Ÿå¼€å§‹ï¼ˆRailway æ¨èï¼‰

1. è®¿é—® https://railway.app
2. ä½¿ç”¨ GitHub ç™»å½•
3. ç‚¹å‡» "New Project" â†’ "Deploy from GitHub repo"
4. é€‰æ‹©æ‚¨çš„ä»“åº“
5. æ·»åŠ ç¯å¢ƒå˜é‡
6. ç­‰å¾…éƒ¨ç½²å®Œæˆ
7. è®¿é—®æä¾›çš„ URL

**å®Œæˆï¼** ğŸ‰

---

## éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®é…ç½®
2. æ„å»ºæ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯
3. æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸
4. API å¯†é’¥æ˜¯å¦æœ‰æ•ˆ
